<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>地址宝</title>
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,400">
	<!-- Google web font "Open Sans" -->
	<link rel="stylesheet" href="css/font-awesome.min.css">
	<link rel="stylesheet" href="css/bootstrap.min.css">
	<link rel="stylesheet" href="css/demo.css" />
	<link rel="stylesheet" href="css/templatemo-style.css">
	<link rel="stylesheet" href="css/jquery-ui.css">
	<script type="text/javascript" src="js/modernizr.custom.86080.js"></script>

</head>

<body>
	<div class="noExtension hide" id="noExtension">
		NOTE: Please install
		<a target="_blank" href="https://github.com/ChengOrangeJu/WebExtensionWallet">WebExtensionWallet</a> to use myAddress
	</div>
	<div id="particles-js"></div>

	<ul class="cb-slideshow">
		<li>xxxxx</li>
		<li>xxx</li>
		<li></li>
		<li></li>
		<li></li>
		<li></li>
	</ul>
	<div class="row cb-slideshow-text-container ">
		<div class="tm-content col-xl-10 col-sm-4 col-xs-4 ml-auto section" id="myheader">
			<header class="mb-5">
				<h1>欢迎来到地址宝！</h1>
			</header>
			<P class="mb-5">还在为繁琐的记住繁琐的币地址烦恼么？地址宝在线为你存储查询你的钱包信息。
			</P>
			<form action="#" method="get" class="subscribe-form">
				<div class="row form-section ">
					<div class="col-md-2 col-sm-2 col-xs-2">
					</div>
					<div class="col-md-5 col-sm-5 col-xs-5">
						<input name="nickname" type="text" class="form-control" id="ipt_nickname" placeholder="你的昵称(电话号码)..." required/>
					</div>
					<div class="col-md-3 col-sm-3 col-xs-2"></div>
				</div>
				<div class="row form-section ">
					<div class="col-md-3 col-sm-4 col-xs-3">
					</div>
					<div class="col-md-3 col-sm-3 col-xs-3">
						<button type="button" class="tm-btn-subscribe" onclick="sure()">确定</button>
					</div>
					<div class="col-md-3 col-sm-3 col-xs-3"></div>
				</div>
			</form>
		</div>
	</div>

	<div class="tm-content col-xl-10 col-sm-4 col-xs-4 ml-auto section" id="mainContent" style="display: none;">
		<header class="mb-5">
			<h3>
				<span id="h_nickname"> 欢迎来到地址宝！</span>
				<a href="javascript:edit_nickname()" style="font-size: 12px;">修改</a>
			</h3>
		</header>
		<form action="#" method="get" class="subscribe-form">
			<div class="row form-section">
				<div class="col-md-1 col-sm-1 col-xs-1" style="vertical-align:middle;height: 60px;line-height:60px;">平台:</div>
				<div class="col-md-1 col-sm-1 col-xs-1">
					<select class="form-section" id="platform_serach" style="height: 60px;">
						<option value="">全部</option>
						<option value="币安">币安</option>
						<option value="火币">火币</option>
					</select>
				</div>
				<div class="col-md-2 col-sm-2 col-xs-2">
					<input name="coinname" type="text" class="form-control" id="coinname_search" placeholder="币种" required/>
				</div>
				<div class="col-md-4 col-sm-4 col-xs-4">
					<button type="button" class="tm-btn-subscribe" onclick="search()">查询</button>
					<button type="button" class="tm-btn-subscribe" onclick="add()">添加</button>
				</div>
			</div>
			<div class="row form-section">
				<div class="col-md-1 col-sm-1 col-xs-1">
					结果:
				</div>
				<div class="col-md-11 col-sm-11 col-xs-11">
					<ul id="serach_result">
						<li>请点击查询按钮</li>
					</ul>
				</div>
			</div>
		</form>
	</div>
	<div class="footer-link">
		<p>Copyright © 2018 auto technology - Design:
			<a rel="nofollow" href="#" target="_parent">outman</a>
		</p>
	</div>

	<div class="tm-content col-xl-10 col-sm-4 col-xs-4 ml-auto section" id="add_dialog" style="display: none;">
		<form action="#" method="get" class="subscribe-form">
			<div class="row form-section">
				<div class="col-md-3 col-sm-3 col-xs-3" style="vertical-align:middle;height: 60px;line-height:60px;">平台:</div>
				<div class="col-md-7 col-sm-7 col-xs-7">
					<select class="form-section" id="platform_serach" style="height: 60px;">
						<option value="">全部</option>
						<option value="币安">币安</option>
						<option value="火币">火币</option>
					</select>
				</div>
			</div>
			<div class="row form-section">
				<div class="col-md-3 col-sm-3 col-xs-3" style="vertical-align:middle;height: 60px;line-height:60px;">币种:</div>
				<div class="col-md-7 col-sm-7 col-xs-7">
					<input name="coinname" type="text" class="form-control" id="coinname_search" placeholder="币种" required/>
				</div>
			</div>
			<div class="row form-section">
				<div class="col-md-3 col-sm-3 col-xs-3" style="vertical-align:middle;height: 60px;line-height:60px;"></div>
				<div class="col-md-7 col-sm-7 col-xs-7">
					<button type="button" class="tm-btn-subscribe" onclick="submit()">提交</button>
					<button type="button" class="tm-btn-subscribe" onclick="cancel()">取消</button>
				</div>
			</div>
		</form>
	</div>
</body>

<script type="text/javascript" src="js/particles.js"></script>
<script type="text/javascript" src="js/app.js"></script>
<script src=lib/jquery-3.3.1.min.js></script>
<script type="text/javascript" src="js/jquery-ui.js"></script>
<script src=lib/nebPay.js></script>
<script src=js/alert.js></script>
<script src=lib/bootstrap-4.0.0-dist/js/bootstrap.min.js></script>
<script src=lib/nebulas.js></script>
<script type="text/javascript">

	function sure() {
		if ($("#ipt_nickname").val() === "") {
			myAlert('系统提示', "昵称不能为空！");
			return;
		}
		$("#myheader").fadeOut();
		$("#mainContent").fadeIn();
		$("#h_nickname").text($("#ipt_nickname").val());
		search();
	}
	function edit_nickname() {
		$("#myheader").fadeIn();
		$("#mainContent").fadeOut();
	}
	
	var dappAddress = "n1grRkmdvt4WSeWjEsWRz5zngBeb4srWTiM";
	var nebulas = require("nebulas"),
		Account = nebulas.Account,
		neb = new nebulas.Neb();
	neb.setRequest(new nebulas.HttpRequest("https://testnet.nebulas.io"));
	var from = "n1ExsLQe3ExsHSRgEwfKPP3LeLjoq63KqRv";//Account.NewAccount().getAddressString();
	// 搜索功能: 查找Super-Dictionary 中有没有该词条
	function search() {
		// $("#search_value").val() 搜索框内的值
		var value = "0";
		var nonce = "0"
		var gas_price = "1000000"
		var gas_limit = "2000000"
		var callFunction = "get";
		var callArgs = "[\"" + $("#h_nickname").text() + "\"]";
		var contract = {
			"function": callFunction,
			"args": callArgs
		}
		neb.api.call(from, dappAddress, value, nonce, gas_price, gas_limit, contract).then(function (resp) {
			cbSearch(resp)
		}).catch(function (err) {
			//cbSearch(err)
			console.log("error:" + err.message)
		})
	}
	//return of search,
	function cbSearch(resp) {
		var result = resp.result    ////resp is an object, resp.result is a JSON string
		console.log("return of rpc call: " + JSON.stringify(result))
		if (result === 'null') {
			var ul = $("#serach_result").empty();
			$("<li>没查询出任何结果（可能你并没有录入过数据，请点击添加按钮 添加数据）</li>").appendTo(ul);
		} else {
			//if result is not null, then it should be "return value" or "error message"
			try {
				result = JSON.parse(result)
			} catch (err) {
				//result is the error message
			}
			var ul = $("#serach_result").empty();
			if (!!result.addressModels) {      //"return value"
				for (var i = 0; i < result.addressModels.length; i++) {
					var o = result.addressModels[i];
					if ($("#platform_serach").val() !== "" && o.platform !== $("#platform_serach").val()) {
						continue;
					}
					if ($("#coinname_search").val() !== "" && o.tokenName !== $("#coinname_search").val()) {
						continue;
					}
					$("<li>[" + o.platform + "]" + o.tokenName + ":" + o.address + "</li>").appendTo(ul);
				}
				if ($("#serach_result").children().length === 0) {
					$("<li>没查询出任何结果</li>").appendTo(ul);
				}
			} else {
				$("<li>没查询出任何结果</li>").appendTo(ul);
			}
		}
	}
	function add() {
		var html = "<div>平台: <select id='add_platform'><option value='币安'>币安</option> <option value='火币'>火币</option> </select></div>";
		html += "<div>币种:<input type='text' id='add_cointype' style='width:200px;'>";
		html += "<div>地址:<input type='text' id='add_address'  style='width:200px;'>";
		myConfirm("添加信息", html, function (result) {
			if (result) {
				var value = "0";
				var nonce = "0"
				var gas_price = "1000000"
				var gas_limit = "2000000"
				var callFunction = "save";
				var nickname = $("#h_nickname").text();
				var platform = $("#add_platform").val();
				if(platform==""){
					myAlert("系统提示","平台不能为空！");
					return false;
				}
				var tokenName =$("#add_cointype").val();
				if(tokenName==""){
					myAlert("系统提示","币名称不能为空！");
					return false;
				}
				var address =$("#add_address").val();
				if(address==""){
					myAlert("系统提示","地址不能为空！");
					return false;
				}
				var callArgs = "[\"" + nickname + "\",\"" + platform + "\",\"" + tokenName + "\",\"" + address + "\"]";
				var contract = {
					"function": callFunction,
					"args": callArgs
				}
				neb.api.call(from, dappAddress, value, nonce, gas_price, gas_limit, contract).then(function (resp) {
					cbSearch(resp)
				}).catch(function (err) {
					//cbSearch(err)
					console.log("error:" + err.message)
				})
				return true;
			}
		})
	}
</script>
</html>